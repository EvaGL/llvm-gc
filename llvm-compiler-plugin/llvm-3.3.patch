diff -urPp X86_old/X86FrameLowering.cpp X86_new/X86FrameLowering.cpp
--- X86_old/X86FrameLowering.cpp	2013-05-16 04:30:10.000000000 +0400
+++ X86_new/X86FrameLowering.cpp	2013-11-29 13:11:58.192457000 +0400
@@ -29,7 +29,7 @@
 #include "llvm/MC/MCSymbol.h"
 #include "llvm/Support/CommandLine.h"
 #include "llvm/Target/TargetOptions.h"
-
+#include "llvm/IR/Module.h"
 using namespace llvm;
 
 // FIXME: completely move here.
@@ -46,7 +46,12 @@ bool X86FrameLowering::hasFP(const Machi
   const MachineFrameInfo *MFI = MF.getFrameInfo();
   const MachineModuleInfo &MMI = MF.getMMI();
   const TargetRegisterInfo *RegInfo = TM.getRegisterInfo();
-
+  // jblab-gc needs frame pointer in order to find roots in stack
+  const Function* F = MF.getFunction();
+  if (F->hasGC() && strcmp(F->getGC(), "jblab-gc") == 0) {
+    return true;
+  }
+  
   return (MF.getTarget().Options.DisableFramePointerElim(MF) ||
           RegInfo->needsStackRealignment(MF) ||
           MFI->hasVarSizedObjects() ||
@@ -781,6 +786,16 @@ void X86FrameLowering::emitPrologue(Mach
       Moves.push_back(MachineMove(FrameLabel, FPDst, FPSrc));
     }
 
+    // Push pointer to stack map 
+    const Function* F = MF.getFunction();
+    if (F->hasGC() && strcmp(F->getGC(), "jblab-gc") == 0) {
+        std::string label = "__gc_" + std::string(F->getName()); 
+        const GlobalVariable* value = MMI.getModule()->getGlobalVariable(label);   
+        BuildMI(MBB, MBBI, DL, TII.get(Is64Bit ? X86::PUSH64r : X86::PUSH32r))
+            .addGlobalAddress(value)
+            .setMIFlag(MachineInstr::FrameSetup);
+    }
+
     // Update EBP with the new base value.
     BuildMI(MBB, MBBI, DL,
             TII.get(Is64Bit ? X86::MOV64rr : X86::MOV32rr), FramePtr)
@@ -1046,6 +1061,14 @@ void X86FrameLowering::emitEpilogue(Mach
     } else {
       NumBytes = FrameSize - CSSize;
     }
+    // jblab-gc requires more clean-up
+    const Function* F = MF.getFunction();
+    if (F->hasGC() && strcmp(F->getGC(), "jblab-gc") == 0) {
+    //emitSPUpdate(MBB, MBBI, StackPtr, NumBytes, Is64Bit, IsLP64, UseLEA,
+      //           TII, *RegInfo);
+        emitSPUpdate(MBB, MBBI, StackPtr, Is64Bit ? 8 : 4, Is64Bit, IsLP64, UseLEA, TII, *RegInfo);
+    }
+
 
     // Pop EBP.
     BuildMI(MBB, MBBI, DL,
